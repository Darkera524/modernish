#! /usr/bin/env modernish
use var/arith/ops	# for 'inc'

# This test program demonstrates that 'die' can kill the main program
# even from a background subshell.
#
# Conversely, the trap on INT (user presses Ctrl-C) demonstrates how to kill
# the background job from the main shell (which was always possible).

print 'This program will self-destruct in 10 seconds.'
( sleep 10; die 'suicide!' ) &
bgjob=$!

# without the trap, the background process would go on if you press Ctrl-C
# (note: 'pushtrap' does not cause signal to be ignored, unlike 'trap', so
# no 'exit' needed)
pushtrap "kill $bgjob" INT

print 'Entering infinite loop...'
x=0
forever do
	echo -n "$x "
	inc x
	sleep 1
done
